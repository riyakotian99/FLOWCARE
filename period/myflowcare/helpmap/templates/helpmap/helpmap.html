
{% extends "base.html" %}
{% load static %}

{% block head %}
  <!-- main helpmap styles -->
  <link rel="stylesheet" href="{% static 'helpmap/css/helpmap.css' %}?v=13">

  <!-- ComfortWall-like infobox CSS (copied/adapted) -->
  <style>
  /* Infobox stack with FlowCare pinks (for HelpMap bottom-up look) */
  .info-stack {
    display: flex;
    flex-direction: column;
    gap: 14px;
    width: 100%;
    margin-bottom: 1rem;
  }

  .infobox {
    position: relative;
    border-radius: 12px;
    padding: 14px 18px;
    box-shadow: 0 8px 22px rgba(34,20,30,0.05);
    border: 1px solid rgba(217,74,134,0.08);
    background: linear-gradient(180deg,#fff6fb,#fff0f6);
  }

  /* headline (lighter pink box) */
  .infobox--headline {
    background: linear-gradient(180deg,#fff6fb,#ffe6f0);
    border: 3px solid #f85a8f;
    color: #9b1f53;
    font-weight: 800;
    padding: 12px 16px;
    text-align: left;
    font-size: 1rem;
  }

  /* body (stronger pink box) */
  .infobox--body {
    background: linear-gradient(180deg,#b36491,#b36491);
    border: 3px solid #6d2264;
    color: #fff;
    font-weight: 700;
    padding: 16px 20px;
    text-align: left;
    font-size: 0.98rem;
  }

  .infobox--body .comfort-banner__muted {
    display: block;
    margin-top: 0.5rem;
    font-weight: 500;
    font-size: 0.92rem;
    color: rgba(255,230,240,0.9);
  }

  /* CTA / action button used inside infobox right area */
  .infobox-actions { margin-top: 10px; display:flex; gap:8px; justify-content:flex-start; }
  .infobox .btn { border-radius:10px; padding:8px 12px; font-weight:700; border:none; cursor:pointer; }
  .btn-hero { background:#fff; color:#d63a70; border:2px solid #fff; }

  /* ComfortWall title-like styling (small, used if needed) */
  .comfort-banner__title {
    margin-top: 1rem;
    font-size: 1.5rem;
    font-weight: 800;
    letter-spacing: 0.3px;
    text-align: left;
    background: linear-gradient(90deg, #f85a8f, #d63a70);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    -webkit-text-fill-color: transparent;
  }

  /* small responsive tweaks */
  @media (max-width:720px){
    .infobox { padding:12px; border-radius:10px; }
    .comfort-banner__title { font-size:1.15rem; }
  }
  </style>
{% endblock %}

{% block content %}
<div class="helpmap-page" role="main" aria-labelledby="helpmap-title" style="max-width:980px;margin:24px auto;padding:8px;">

  <!-- HERO on TOP -->
  <header class="hm-hero-box" style="margin-bottom:18px;">
    <div style="display:flex;align-items:center;gap:14px;">
      <div style="width:48px;height:48px;display:grid;place-items:center;border-radius:12px;background:linear-gradient(180deg,#fff,#fbeef8);box-shadow:0 6px 18px rgba(200,80,130,0.06);">
        <!-- small pin icon -->
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2C8.7 2 6 4.7 6 8c0 5.3 6 12 6 12s6-6.7 6-12c0-3.3-2.7-6-6-6z" fill="#d63a70"/><circle cx="12" cy="8" r="2.2" fill="#fff"/></svg>
      </div>

      <div>
        <h1 id="helpmap-title" style="margin:0;font-size:1.6rem;color:#a61f57;font-weight:800;">Help Map — Find medicals near you</h1>
        <p style="margin:6px 0 0;color:#6d5b66;">Search pharmacies, clinics, hospitals, and doctors near you.</p>
      </div>
    </div>
  </header>

  <!-- ----- INFObOX STACK (bottom-up visual style like ComfortWall) ----- -->
  <section class="info-stack" aria-label="Important notices">

    <!-- Headline box -->
    <div class="infobox infobox--headline" role="status">
      If you or someone is in immediate danger, call your local emergency number.
    </div>

    <!-- Body box with supportive message + CTA -->
    <!-- Body box with supportive message (button removed) -->
<div class="infobox infobox--body" role="note">
  A safe, supportive space — find medicals nearby quickly.
  <span class="comfort-banner__muted">
    Opens Google Maps in a new tab using your device location.
  </span>
</div>

  </section>
  <!-- ----- end infobox stack ----- -->

  <!-- ----- CONTROLS stacked in neat boxes ----- -->
  <div class="infobox" style="margin-bottom:12px;">
    <label for="amenity-select" style="font-weight:700;display:block;margin-bottom:6px;color:#7b2850;">Choose category</label>
    <select id="amenity-select" class="hm-select" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(217,74,134,0.25);">
      <option value="pharmacy">Pharmacy</option>
      <option value="hospital">Hospital</option>
      <option value="clinic">Clinic</option>
      <option value="doctor">Doctors</option>
      <option value="healthcare">Healthcare</option>
      <option value="medical" selected>All (pharmacy, hospital, clinic...)</option>
    </select>
  </div>

  <div class="infobox" style="margin-bottom:12px;">
    <label for="radius" style="font-weight:700;display:block;margin-bottom:6px;color:#7b2850;">Radius (meters)</label>
    <input id="radius" type="number" min="100" step="100" value="2000" style="width:180px;padding:10px;border-radius:8px;border:1px solid rgba(217,74,134,0.25); margin-bottom:8px;" />

    <div style="display:flex;gap:10px;align-items:center;margin-top:8px;">
      <button id="find-btn" class="btn btn-hero" style="background:linear-gradient(180deg,#f48fb1,#d63a70);color:#fff;border:none;padding:10px 14px;border-radius:8px;font-weight:800;cursor:pointer;">Find medicals near me</button>
      <button id="clear-btn" style="background:transparent;border:2px solid rgba(255,255,255,0.2);padding:8px 12px;border-radius:8px;cursor:pointer;background:#fff;color:#c22b5f;font-weight:700;">Clear</button>
    </div>
  </div>


  <!-- preview / info box -->
  <div class="infobox" id="map-preview" aria-live="polite" style="margin-bottom:12px;">
    <div style="color:#af2586;font-weight:700;">Ready — choose a category and click <strong>Find medicals near me</strong>.</div>
  </div>

  <!-- need help box -->
  <div class="infobox" style="margin-bottom:6px;">
    <div style="font-weight:700;color:#9b1f53;">Need help? <a href="/contact" style="color:#9b1f53;text-decoration:underline;">Contact us</a></div>
  </div>

</div>

<!-- Inline JS (same behaviour) -->
<script>
(function(){
  const findBtn = document.getElementById('find-btn');
  const clearBtn = document.getElementById('clear-btn');
  const select = document.getElementById('amenity-select');
  const radiusInput = document.getElementById('radius');
  const preview = document.getElementById('map-preview');

  function setPreview(html){
    if(!preview) return;
    preview.innerHTML = html;
  }

  findBtn.addEventListener('click', () => {
    const amenity = select.value || 'medical';
    const radius = parseInt(radiusInput.value,10) || 2000;

    if (!navigator.geolocation) { alert('Geolocation not supported'); return; }
    const old = findBtn.innerHTML;
    findBtn.disabled = true;
    findBtn.innerHTML = 'Locating…';

    navigator.geolocation.getCurrentPosition((pos) => {
      const lat = pos.coords.latitude, lon = pos.coords.longitude;
      const phrase = `${amenity} within ${radius}m`;
      const q = encodeURIComponent(phrase);
      const mapsUrl = `https://www.google.com/maps/search/${q}/@${lat},${lon},15z`;
      setPreview('<div style="color:#fff3f7;font-weight:700;">Opening Google Maps for <strong>' + amenity + '</strong> within <strong>' + radius + 'm</strong>.</div>');
      window.open(mapsUrl,'_blank');
      findBtn.disabled = false;
      findBtn.innerHTML = old;
    }, (err) => {
      alert('Could not get location: ' + (err.message || err.code));
      findBtn.disabled = false;
      findBtn.innerHTML = old;
    }, { enableHighAccuracy:true, timeout:10000, maximumAge:60000 });
  });

  clearBtn.addEventListener('click', () => {
    select.value = 'medical';
    radiusInput.value = 2000;
    setPreview('<div style="color:#fff3f7;font-weight:700;">Cleared. Choose a category and click <strong>Find medicals near me</strong>.</div>');
  });
})();
</script>
{% endblock %}
